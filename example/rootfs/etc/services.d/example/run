#!/usr/bin/with-contenv bashio
# ==============================================================================
# Startet den Tibber Uploader Service zu einer bestimmten Tageszeit
# ==============================================================================

# Set environment variables from the add-on configuration
export METER_SENSOR=$(bashio::config 'meter_sensor')
export EMAIL=$(bashio::config 'email')
export PASSWORD=$(bashio::config 'password')

# Log the start time and environment variables
echo "=================================================================================================="
echo "################ Starting Tibber Uploader service at $(date)" ################
echo "=================================================================================================="

# Starten Sie den Service
python3 /usr/bin/main.py

# Log the end time
echo "=================================================================================================="
echo "################ Tibber Uploader service finished at $(date)" ################
echo "=================================================================================================="

# Funktion zum Warten bis 01:00 Uhr morgens
wait_until_1_am() {
    local current_time
    local target_time
    target_time=$(date -d '01:00' +%s)
    current_time=$(date +%s)
    local time_until_1_am=$((target_time - current_time))
    
    if ((time_until_1_am <= 0)); then
        # Es ist bereits nach 01:00 Uhr, daher warten Sie bis zum nÃ¤chsten Tag
        time_until_1_am=$((time_until_1_am + 24 * 3600))
    fi
    
    s6-sleep "$time_until_1_am"s
}

